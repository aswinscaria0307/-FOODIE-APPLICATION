{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { AddressDialogComponent } from '../address-dialog/address-dialog.component';\nimport { DatePipe } from '@angular/common';\nlet CartComponent = class CartComponent {\n  constructor(foodie, route, dialog, user, login, _sanckBar) {\n    this.foodie = foodie;\n    this.route = route;\n    this.dialog = dialog;\n    this.user = user;\n    this.login = login;\n    this._sanckBar = _sanckBar;\n    this.items = [];\n    this.theItem = null;\n    this.total = 0;\n    this.subtotal = 0;\n    this.shipping = 0;\n    this.goToPayment = () => {\n      let data = {\n        orderAmount: this.subtotal,\n        orderInfo: \"order_request\"\n      };\n      this.foodie.createPaymentOrder(data).subscribe(response => {\n        console.log(response);\n        if (response.status == 'created') {\n          //open payment form\n          var options = {\n            key: 'rzp_test_pVaEM3TS2Oh7JN',\n            amount: response.amount,\n            currency: 'INR',\n            name: 'Foodie',\n            description: 'order total amount',\n            image: 'data:image/png;base64,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',\n            order_id: response.id,\n            handler: response => {\n              console.log(response.razorpay_payment_id);\n              console.log(response.razorpay_order_id);\n              console.log(response.razorpay_signature);\n              this.paymentSuccess(); // Call the paymentSuccess() function\n            },\n\n            prefill: {\n              name: \"\",\n              email: \"\",\n              contact: \"\"\n            },\n            notes: {\n              address: \"Razorpay Corporate Office\"\n            },\n            theme: {\n              color: \"#3399cc\"\n            }\n          };\n          var rzp = new Razorpay(options);\n          rzp.on('payment.failed', function (response) {\n            console.log(response.error.code);\n            console.log(response.error.description);\n            console.log(response.error.source);\n            console.log(response.error.step);\n            console.log(response.error.reason);\n            console.log(response.error.metadata.order_id);\n            console.log(response.error.metadata.payment_id);\n          });\n          rzp.open();\n        }\n      }, failure => {\n        console.log(failure);\n        alert(\"Something went wrong...\");\n      });\n    };\n  }\n  ngOnInit() {\n    this.updateCurrentTime();\n    this.user.getAddress().subscribe(response => {\n      this.address = response;\n    });\n    this.user.addressChanged.subscribe(res => {\n      this.ngOnInit();\n    });\n    this.foodie.getItems(\"incart\", localStorage.getItem('email')).subscribe(response => {\n      console.log(response);\n      this.items = response;\n      this.totalPrice();\n    }, error => {\n      this.items = [];\n    });\n  }\n  updateCurrentTime() {\n    const currentDate = new Date();\n    currentDate.setMinutes(currentDate.getMinutes() + 15);\n    const datePipe = new DatePipe('en-US');\n    this.time1 = datePipe.transform(currentDate, 'h:mm:ss a') || '';\n    currentDate.setMinutes(currentDate.getMinutes() + 15);\n    this.time2 = datePipe.transform(currentDate, 'h:mm:ss a') || '';\n  }\n  remove(itemName) {\n    if (itemName != null) {\n      let remove = this.items.find(item => item.itemName === itemName);\n      console.log(remove);\n      if (remove != undefined) {\n        this.foodie.removeItem(localStorage.getItem('email'), remove).subscribe(response => {\n          this.ngOnInit();\n          this.totalPrice();\n        });\n      }\n    }\n  }\n  add(itemName) {\n    if (itemName != null) {\n      let add = this.items.find(item => item.itemName === itemName);\n      console.log(add);\n      if (add != undefined) {\n        this.foodie.addItem(localStorage.getItem('email'), add).subscribe(responce => {\n          this.ngOnInit();\n          this.totalPrice();\n        });\n      }\n    }\n  }\n  totalPrice() {\n    this.total = this.items.map(item => {\n      if (item.itemPrice && item.count) {\n        return item.itemPrice * item.count;\n      }\n      return 0;\n    }).reduce((acc, val) => acc + val, 0);\n    this.subtotal = this.total;\n    if (this.total > 100) {\n      this.shipping = 0;\n    }\n    if (this.total < 100) {\n      this.shipping = 50;\n    }\n    if (this.total < 100) {\n      this.subtotal = this.total + this.shipping;\n    }\n  }\n  calculateTotalPrice(itemname) {\n    let itemTotal = 0;\n    this.items.map(item => {\n      if (item.itemName == itemname && item.count && item.itemPrice) {\n        itemTotal = item.count * item.itemPrice;\n      }\n    });\n    return itemTotal;\n  }\n  paymentSuccess() {\n    this.foodie.placeOrder(this.items, localStorage.getItem(\"email\")).subscribe(response => {\n      this._sanckBar.open('Order Placed successfully.....', 'success', {\n        duration: 5000,\n        panelClass: ['mat-toolbar', 'mat-primary']\n      });\n      setTimeout(() => {\n        this.route.navigateByUrl(\"/myOrders\");\n      }, 2500);\n    }, error => {\n      console.error(\"payment done but order not placed contact customer care:\", error);\n    });\n    let body = \"\";\n    for (const item of this.items) {\n      body += `${item.itemName} ( ${item.count} items on the way), `;\n    }\n    body = body.slice(0, -2);\n    this.foodie.sendMail(localStorage.getItem(\"email\"), \"Order Placed Successfully\", body).subscribe(() => {\n      console.log(\"Email sent successfully\");\n    }, error => {\n      console.error(\"Error sending email:\", error);\n    });\n    // this.foodie.sendSms(localStorage.getItem(\"number\"), body )//\n    // .subscribe(() => {\n    //   console.log(\"Sms sent successfully\");\n    // }, (error) => {\n    //   console.error(\"Error sending Sms:\", error);\n    // });\n  }\n\n  changeAddress() {\n    const dialogRef = this.dialog.open(AddressDialogComponent, {\n      width: '700px'\n    });\n  }\n};\nCartComponent = __decorate([Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})], CartComponent);\nexport { CartComponent };","map":{"version":3,"mappings":"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","names":["Component","AddressDialogComponent","DatePipe","CartComponent","constructor","foodie","route","dialog","user","login","_sanckBar","data","orderAmount","subtotal","orderInfo","createPaymentOrder","subscribe","response","console","log","status","options","key","amount","currency","name","description","image","order_id","id","handler","razorpay_payment_id","razorpay_order_id","razorpay_signature","paymentSuccess","prefill","email","contact","notes","address","theme","color","rzp","Razorpay","on","error","code","source","step","reason","metadata","payment_id","open","failure","alert","ngOnInit","updateCurrentTime","getAddress","addressChanged","res","getItems","localStorage","getItem","items","totalPrice","currentDate","Date","setMinutes","getMinutes","datePipe","time1","transform","time2","remove","itemName","find","item","undefined","removeItem","add","addItem","responce","total","map","itemPrice","count","reduce","acc","val","shipping","calculateTotalPrice","itemname","itemTotal","placeOrder","duration","panelClass","setTimeout","navigateByUrl","body","slice","sendMail","changeAddress","dialogRef","width","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["F:\\CAPSTONE PROJECT- FOODIE APP\\FoodieApplicationFE\\FoodieApplication\\src\\app\\cart\\cart.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Item } from '../model/item';\nimport { FoodieService } from '../service/foodie.service';\nimport { RazorpayResponse } from '../model/razorPay';\nimport { PaymentOrder } from '../model/paymentOrder';\nimport { Router } from '@angular/router';\nimport { Address } from '../model/address';\nimport { MatDialog } from '@angular/material/dialog';\nimport { AddressDialogComponent } from '../address-dialog/address-dialog.component';\nimport { UserService } from '../service/user.service';\nimport { LoginService } from '../service/login.service';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { DatePipe } from '@angular/common';\n\ndeclare var Razorpay:any;\n\n@Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})\nexport class CartComponent implements OnInit{\n  items:Item[]=[];\n  theItem:Item|null=null;\n   total:number=0;\n   subtotal:number=0;\n   shipping:number=0;\n   address:Address | undefined;\n   time1!: string;\n   time2!: string;\n\nconstructor(private foodie:FoodieService,private route:Router,private dialog: MatDialog,private user:UserService,private login:LoginService,private _sanckBar:MatSnackBar){\n}\nngOnInit(): void {\n  this.updateCurrentTime();\n  this.user.getAddress().subscribe((response:Address)=>{\n    this.address=response;\n  });\n  this.user.addressChanged.subscribe((res)=>{\n    this.ngOnInit();\n  })\n  this.foodie.getItems(\"incart\",localStorage.getItem('email')).subscribe(response=>{\n    console.log(response);\n    this.items=response; \n    this.totalPrice();   \n  },(error)=>{\n    this.items=[];\n  });\n}\nupdateCurrentTime() {\n  const currentDate = new Date();\n    currentDate.setMinutes(currentDate.getMinutes() + 15);\n    const datePipe = new DatePipe('en-US');\n    this.time1 = datePipe.transform(currentDate, 'h:mm:ss a') || '';\n    currentDate.setMinutes(currentDate.getMinutes() + 15);\n    this.time2 = datePipe.transform(currentDate, 'h:mm:ss a') || '';\n    \n}\nremove(itemName?:string){\n  if(itemName!=null){\n    let remove:Item |undefined=this.items.find(item => item.itemName === itemName)\n    console.log(remove);\n    if(remove!=undefined){\n    this.foodie.removeItem(localStorage.getItem('email'),remove).subscribe(response=>{\n      this.ngOnInit();\n      this.totalPrice();\n          });\n    }\n  }\n} \n \nadd(itemName?:string){\n  if(itemName!=null){\n    let add:Item |undefined=this.items.find(item => item.itemName === itemName)\n    console.log(add);\n    if(add!=undefined){\n    this.foodie.addItem(localStorage.getItem('email'),add).subscribe(responce=>{\n      this.ngOnInit();\n      this.totalPrice();\n    })\n    }\n  }\n}\n\ntotalPrice(){\n  this.total = this.items.map(item => {\n    if (item.itemPrice&&item.count) {\n      return item.itemPrice*item.count;\n    }\n    return 0;\n  })\n  .reduce((acc, val) => acc + val, 0);\n  this.subtotal=this.total;\n  if(this.total>100){\n    this.shipping=0;    \n  }\n  if(this.total<100){\n    this.shipping=50;    \n  }\n  if(this.total<100){\n    this.subtotal=this.total+this.shipping;\n  }\n  \n  }\n\n  calculateTotalPrice(itemname: string | undefined): number {\n    let itemTotal = 0;\n    this.items.map((item) => {\n      if (item.itemName == itemname && item.count && item.itemPrice) {\n        itemTotal = item.count * item.itemPrice;\n      }\n    });\n    return itemTotal;\n  }\n   goToPayment =()=>{\n    let data:PaymentOrder={orderAmount:this.subtotal,orderInfo:\"order_request\"};\n    this.foodie.createPaymentOrder(data).subscribe((response:any)=>{\n      console.log(response); \n      if(response.status=='created'){\n        //open payment form\n        var options={\n          key:'rzp_test_pVaEM3TS2Oh7JN',\n          amount:response.amount,\n          currency:'INR',\n          name:'Foodie',\n          description:'order total amount',\n          image:'data:image/png;base64,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',\n          order_id:response.id,\n          handler: (response: RazorpayResponse) => {\n            console.log(response.razorpay_payment_id);\n            console.log(response.razorpay_order_id);\n            console.log(response.razorpay_signature);\n            this.paymentSuccess(); // Call the paymentSuccess() function\n          },\n          prefill: {\n            name: \"\",\n            email: \"\",\n            contact: \"\"\n              },\n          notes: {\n            address: \"Razorpay Corporate Office\"\n                \n                },\n          theme: {\n            color: \"#3399cc\"\n                }              \n        };\n        var rzp = new Razorpay(options) as any;\nrzp.on('payment.failed', function (response:any){\nconsole.log(response.error.code);\nconsole.log(response.error.description);\nconsole.log(response.error.source);\nconsole.log(response.error.step);\nconsole.log(response.error.reason);\nconsole.log(response.error.metadata.order_id);\nconsole.log(response.error.metadata.payment_id);\n \n});\nrzp.open();\n      }\n    },failure=>{\n      console.log(failure);\n      alert(\"Something went wrong...\")\n    })\n  }\n\n  paymentSuccess() {\n    this.foodie.placeOrder(this.items,localStorage.getItem(\"email\")).subscribe(response=>{\n      this._sanckBar.open('Order Placed successfully.....', 'success', {\n        duration: 5000,\n        panelClass: ['mat-toolbar', 'mat-primary']\n      });\n      setTimeout(() => {\n        this.route.navigateByUrl(\"/myOrders\");\n      }, 2500);\n      },(error) => {\n      console.error(\"payment done but order not placed contact customer care:\", error);\n    })\n          let body=\"\";\n          for (const item of this.items) {\n            body += `${item.itemName} ( ${item.count} items on the way), `;\n            }\n            body = body.slice(0, -2);\n\n    this.foodie.sendMail(localStorage.getItem(\"email\"), \"Order Placed Successfully\",body )\n      .subscribe(() => {\n        console.log(\"Email sent successfully\");\n      }, (error) => {\n        console.error(\"Error sending email:\", error);\n      });\n      // this.foodie.sendSms(localStorage.getItem(\"number\"), body )//\n      // .subscribe(() => {\n      //   console.log(\"Sms sent successfully\");\n      // }, (error) => {\n      //   console.error(\"Error sending Sms:\", error);\n      // });\n  }\n\n  changeAddress(){\n      const dialogRef = this.dialog.open(AddressDialogComponent, {\n        width: '700px',\n      });\n  }\n  \n}\n\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}